import os
from nanovllm import LLM, SamplingParams
from nanovllm.utils.logger import init_logger
from transformers import AutoTokenizer

logger = init_logger(__name__)


def main():
    path = os.path.expanduser("/data/model/Qwen3-0.6B")
    tokenizer = AutoTokenizer.from_pretrained(path)
    llm = LLM(path, enforce_eager=False, tensor_parallel_size=1, max_num_seqs=16, kvcache_block_size=128, trust_remote_code=True)
    sampling_params = SamplingParams(temperature=0.6, max_tokens=2048)

    prompts = [
        "你是谁",
        "who are you",
        "9.11和9.8哪个数更大",
        "9.11 and 9.8, which is greater?",
        "讲一个笑话，200字",
        "写一个作文，题材任意，300字",
        "中国是",
        "某港口每日集装箱吞吐量数据可视为实数序列 $\\{x_n\\}$，已知该序列单调递增且有上界。利用单调收敛定理，证明该序列必收敛，并填空完成以下调度优化问题：若港口调度系统通过矩阵 $A$ 对集装箱分配进行对角化优化，矩阵 $A$ 的特征值为 $\\lambda_1=3, \\lambda_2=1, \\lambda_3=0$，则对角化后矩阵的主对角线元素为________。",
        "一个3x3x3的魔方，对于任何乱序状态，数学家证明了任意状态至多需要20次移动能够达到还原状态。假设小华每次操作恰好是导向还原状态的最优步骤，但他每次操作的时间都是之前的两倍，第一次操作耗时2秒，问他完成魔方还原最少需要多少时间？",
        "赵女士买了一些水果和小食品准备去看望一个朋友，谁知，这些水果和小食品被他们的儿子们偷吃了，但她不知道是哪个儿子，为此，赵女士非常生气，就盘问4个儿子谁偷吃了水果和小食品。老大说道：“是老二吃的”，老二说道：“是老四偷吃的”，老三说道：“反正我没有偷吃”，老四说道：“老二在说谎”。就这四个儿子中只有一个人说了实话，其他3个都在撒谎。那么，到底是是谁偷吃了这些水果和小食品？",
        "Transcribed from the 1915 Martin Secker edition by David Price, email\nccx074@pglaf.org\n\n                          [Picture: Book cover]\n\n\n\n\n\n                                   THE\n                                COXON FUND\n\n\n                              BY HENRY JAMES\n\n                      [Picture: Decorative graphic]\n\n                                * * * * *\n\n                          LONDON: MARTIN SECKER\n                     NUMBER FIVE JOHN STREET ADELPHI\n\n                                * * * * *\n\n                    This edition first published 1915\n\n                       The text follows that of the\n                            Definitive Edition\n\n                                * * * * *\n\n\n\n\nI\n\n\n\u201cTHEY\u2019VE got him for life!\u201d I said to myself that evening on my way back\nto the station; but later on, alone in the compartment (from Wimbledon to\nWaterloo, before the glory of the District Railway) I amended this\ndeclaration in the light of the sense that my friends would probably\nafter all not enjoy a monopoly of Mr. Saltram.  I won\u2019t pretend to have\ntaken his vast measure on that first occasion, but I think I had achieved\na glimpse of what the privilege of his acquaintance might mean for many\npersons in the way of charges accepted.  He had been a great experience,\nand it was this perhaps that had put me into the frame of foreseeing how\nwe should all, sooner or later, have the honour of dealing with him as a\nwhole.  Whatever impression I then received of the amount of this total,\nI had a full enough vision of the patience of the Mulvilles.  He was to\nstay all the winter: Adelaide dropped it in a tone that drew the sting\nfrom the inevitable emphasis.  These excellent people might indeed have\nbeen content to give the circle of hospitality a diameter of six months;\nbut if they didn\u2019t say he was to stay all summer as well it was only\nbecause this was more than they ventured to hope.  I remember that at\ndinner that evening he wore slippers, new and predominantly purple, of\nsome queer carpet-stuff; but the Mulvilles were still in the stage of\nsupposing that he might be snatched from them by higher bidders.  At a\nlater time they grew, poor dears, to fear no snatching; but theirs was a\nfidelity which needed no help from competition to make them proud.\nWonderful indeed as, when all was said, you inevitably pronounced Frank\nSaltram, it was not to be overlooked that the Kent Mulvilles were in\ntheir way still more extraordinary: as striking an instance as could\neasily be encountered of the familiar truth that remarkable men find\nremarkable conveniences.\n\nThey had sent for me from Wimbledon to come out and dine, and there had\nbeen an implication in Adelaide\u2019s note\u2014judged by her notes alone she\nmight have been thought silly\u2014that it was a case in which something\nmomentous was to be determined or done.  I had never known them not be in\na \u201cstate\u201d about somebody, and I dare say I tried to be droll on this\npoint in accepting their invitation.  On finding myself in the presence\nof their latest discovery I had not at first felt irreverence droop\u2014and,\nthank heaven, I have never been absolutely deprived of that alternative\nin Mr. Saltram\u2019s company.  I saw, however\u2014I hasten to declare it\u2014that\ncompared to this specimen their other phoenixes had been birds of\ninconsiderable feather, and I afterwards took credit to myself for not\nhaving even in primal bewilderments made a mistake about the essence of\nthe man.  He had an incomparable gift; I never was blind to it\u2014it dazzles\nme still.  It dazzles me perhaps even more in remembrance than in fact,\nfor I\u2019m not unaware that for so rare a subject the imagination goes to\nsome expense, inserting a jewel here and there or giving a twist to a\nplume.  How the art of portraiture would rejoice in this figure if the\nart of portraiture had only the canvas!  Nature, in truth, had largely\nrounded it, and if memory, hovering about it, sometimes holds her breath,\nthis is because the voice that comes back was really golden.\n\nThough the great man was an inmate and didn\u2019t dress, he kept dinner on\nthis occasion waiting, and the first words he uttered on coming into the\nroom were an elated announcement to Mulville that he had found out\nsomething.  Not catching the allusion and gaping doubtless a little at\nhis face, I privately asked Adelaide what he had found out.  I shall\nnever forget the look she gave me as she replied: \u201cEverything!\u201d  She\nreally believed it.  At that moment, at any rate, he had found out that\nthe mercy of the Mulvilles was infinite.  He had previously of course\ndiscovered, as I had myself for that matter, that their dinners were\nsoign\u00e9s.  Let me not indeed, in saying this, neglect to declare that I\nshall falsify my counterfeit if I seem to hint that there was in his\nnature any ounce of calculation.  He took whatever came, but he never\nplotted for it, and no man who was so much of an absorbent can ever have\nbeen so little of a parasite.  He had a system of the universe, but he\nhad no system of sponging\u2014that was quite hand-to-mouth.  He had fine\ngross easy senses, but it was not his good-natured appetite that wrought\nconfusion.  If he had loved us for our dinners we could have paid with\nour dinners, and it would have been a great economy of finer matter.  I\nmake free in these connexions with the plural possessive because if I was\nnever able to do what the Mulvilles did, and people with still bigger\nhouses and simpler charities, I met, first and last, every demand of\nreflexion, of emotion\u2014particularly perhaps those of gratitude and of\nresentment.  No one, I think, paid the tribute of giving him up so often,\nand if it\u2019s rendering honour to borrow wisdom I\u2019ve a right to talk of my\nsacrifices.  He yielded lessons as the sea yields fish\u2014I lived for a\nwhile on this diet.  Sometimes it almost appeared to me that his massive\nmonstrous failure\u2014if failure after all it was\u2014had been designed for my\nprivate recreation. ",
        "Produced by Greg Weeks, Stephen Blundell and the Online\nDistributed Proofreading Team at http://www.pgdp.net\n\n\n\n\n\n\n\n\n\nARMAGEDDON--2419 A.D.\n\n_By Philip Francis Nowlan_\n\n\n    _Here, once more, is a real scientifiction story plus. It is a story\n    which will make the heart of many readers leap with joy._\n\n    _We have rarely printed a story in this magazine that for scientific\n    interest, as well as suspense, could hold its own with this\n    particular story. We prophesy that this story will become more\n    valuable as the years go by. It certainly holds a number of\n    interesting prophecies, of which no doubt, many will come true. For\n    wealth of science, it will be hard to beat for some time to come. It\n    is one of those rare stories that will bear reading and re-reading\n    many times._\n\n    _This story has impressed us so favorably, that we hope the author\n    may be induced to write a sequel to it soon._\n\n\n\n\nForeword\n\n\nElsewhere I have set down, for whatever interest they have in this, the\n25th Century, my personal recollections of the 20th Century.\n\nNow it occurs to me that my memoirs of the 25th Century may have an\nequal interest 500 years from now--particularly in view of that unique\nperspective from which I have seen the 25th Century, entering it as I\ndid, in one leap across a gap of 492 years.\n\nThis statement requires elucidation. There are still many in the world\nwho are not familiar with my unique experience. Five centuries from now\nthere may be many more, especially if civilization is fated to endure\nany worse convulsions than those which have occurred between 1975 A.D.\nand the present time.\n\nI should state therefore, that I, Anthony Rogers, am, so far as I know,\nthe only man alive whose normal span of eighty-one years of life has\nbeen spread over a period of 573 years. To be precise, I lived the first\ntwenty-nine years of my life between 1898 and 1927; the other fifty-two\nsince 2419. The gap between these two, a period of nearly five hundred\nyears, I spent in a state of suspended animation, free from the ravages\nof katabolic processes, and without any apparent effect on my physical\nor mental faculties.\n\nWhen I began my long sleep, man had just begun his real conquest of the\nair in a sudden series of transoceanic flights in airplanes driven by\ninternal combustion motors. He had barely begun to speculate on the\npossibilities of harnessing sub-atomic forces, and had made no further\npractical penetration into the field of ethereal pulsations than the\nprimitive radio and television of that day. The United States of America\nwas the most powerful nation in the world, its political, financial,\nindustrial and scientific influence being supreme; and in the arts also\nit was rapidly climbing into leadership.\n\nI awoke to find the America I knew a total wreck--to find Americans a\nhunted race in their own land, hiding in the dense forests that covered\nthe shattered and leveled ruins of their once magnificent cities,\ndesperately preserving, and struggling to develop in their secret\nretreats, the remnants of their culture and science--and the undying\nflame of their sturdy independence.\n\nWorld domination was in the hands of Mongolians and the center of world\npower lay in inland China, with Americans one of the few races of\nmankind unsubdued--and it must be admitted in fairness to the truth, not\nworth the trouble of subduing in the eyes of the Han Airlords who ruled\nNorth America as titular tributaries of the Most Magnificent.\n\nFor they needed not the forests in which the Americans lived, nor the\nresources of the vast territories these forests covered. With the\nperfection to which they had reduced the synthetic production of\nnecessities and luxuries, their remarkable development of scientific\nprocesses and mechanical accomplishment of work, they had no economic\nneed for the forests, and no economic desire for the enslaved labor of\nan unruly race.\n\nThey had all they needed for their magnificently luxurious and degraded\nscheme of civilization, within the walls of the fifteen cities of\nsparkling glass they had flung skyward on the sites of ancient American\ncenters, into the bowels of the earth underneath them, and with\nrelatively small surrounding areas of agriculture.\n\nComplete domination of the air rendered communication between these\ncenters a matter of ease and safety. Occasional destructive raids on the\nwaste lands were considered all that was necessary to keep the \"wild\"\nAmericans on the run within the shelter of their forests, and prevent\ntheir becoming a menace to the Han civilization.\n\nBut nearly three hundred years of easily maintained security, the last\ncentury of which had been nearly sterile in scientific, social and\neconomic progress, had softened and devitalized the Hans.\n\nIt had likewise developed, beneath the protecting foliage of the forest,\nthe growth of a vigorous new American civilization, remarkable in the\nmobility and flexibility of its organization, in its conquest of almost\ninsuperable obstacles, in the development and guarding of its industrial\nand scientific resources, all in anticipation of that \"Day of Hope\" to\nwhich it had been looking forward for generations, when it would be\nstrong enough to burst from the green chrysalis of the forests, soar\ninto the upper air lanes and destroy the yellow incubus.\n\nAt the time I awoke, the \"Day of Hope\" was almost at hand. I shall not\nattempt to set forth a detailed history of the Second War of\nIndependence, for that has been recorded already by better historians\nthan I am. Instead I shall confine myself largely to the part I was\nfortunate enough to play in this struggle and in the events leading up\nto it.\n\n[Illustration: Seen upon the ultroscope viewplate, the battle looked as\nthough it were being fought in daylight, perhaps on a cloudy day, while\nthe explosions of the rockets appeared as flashes of extra brilliance.]\n\nIt all resulted from my interest in radioactive gases. During the latter\npart of 1927 my company, the American Radioactive Gas Corporation, had\nbeen keeping me busy investigating reports of unusual phenomena observed\nin certain abandoned coal mines near the Wyoming Valley, in\nPennsylvania.\n\nWith two assistants and a complete equipment of scientific instruments,\nI began the exploration of a deserted working in a mountainous district,\nwhere several weeks before, a number of mining engineers had reported\ntraces of carnotite[1] and what they believed to be radioactive gases.\nTheir report was not without foundation, it was apparent from the\noutset, for in our examination of the upper levels of the mine, our\ninstruments indicated a vigorous radioactivity.\n\n    [1] A hydrovanadate of uranium, and other metals; used as a source\n    of radium compounds.\n\nOn the morning of December 15th, we descended to one of the lowest\nlevels. To our surprise, we found no water there. Obviously it had\ndrained off through some break in the strata. We noticed too that the\nrock in the side walls of the shaft was soft, evidently due to the\nradioactivity, and pieces crumbled under foot rather easily. We made our\nway cautiously down the shaft, when suddenly the rotted timbers above us\ngave way.\n\nI jumped ahead, barely escaping the avalanche of coal and soft rock, but\nmy companions, who were several paces behind me, were buried under it,\nand undoubtedly met instant death.\n\nI was trapped. Return was impossible. With my electric torch I explored\nthe shaft to its end, but could find no other way out. The air became\nincreasingly difficult to breathe, probably from the rapid accumulation\nof the radioactive gas. In a little while my senses reeled and I lost\nconsciousness.\n\nWhen I awoke, there was a cool and refreshing circulation of air in the\nshaft. I had no thought that I had been unconscious more than a few\nhours, although it seems that the radioactive gas had kept me in a state\nof suspended animation for something like 500 years. My awakening, I\nfigured out later, had been due to some shifting of the strata which\nreopened the shaft and cleared the atmosphere in the working. This must\nhave been the case, for I was able to struggle back up the shaft over a\npile of debris, and stagger up the long incline to the mouth of the\nmine, where an entirely different world, overgrown with a vast forest\nand no visible sign of human habitation, met my eyes.\n\nI shall pass over the days of mental agony that followed in my attempt\nto grasp the meaning of it all. There were times when I felt that I was\non the verge of insanity. I roamed the unfamiliar forest like a lost\nsoul. Had it not been for the necessity of improvising traps and crude\nclubs with which to slay my food, I believe I should have gone mad.\n\nSuffice it to say, however, that I survived this psychic crisis. I shall\nbegin my narrative proper with my first contact with Americans of the\nyear 2419 A.D.\n\n\n\n\nCHAPTER I\n\nFloating Men\n\n\nMy first glimpse of a human being of the 25th Century was obtained\nthrough a portion of woodland where the trees were thinly scattered,\nwith a dense forest beyond.\n\nI had been wandering along aimlessly, and hopelessly, musing over my\nstrange fate, when I noticed a figure that cautiously backed out of the\ndense growth across the glade. I was about to call out joyfully, but\nthere was",
    ]
    prompts = [
        tokenizer.apply_chat_template(
            [{"role": "user", "content": prompt}],
            tokenize=False,
            add_generation_prompt=True,
        )
        for prompt in prompts
    ]
    outputs = llm.generate(prompts, sampling_params)
    pre_prompt_len = 400
    for prompt, output in zip(prompts, outputs):
        logger.info("\n")
        logger.info(f"Prompt[:{pre_prompt_len}]: {prompt[:pre_prompt_len]!r}")
        logger.info(
            f"prompt len: {output['prompt_len']}, completion: len: {len(output['token_ids'])}, text:{output['text']!r}")


if __name__ == "__main__":
    main()
